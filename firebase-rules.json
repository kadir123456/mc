{
  "rules": {
    // ðŸ‘¥ KULLANICI VERÄ°LERÄ°
    "users": {
      "$userId": {
        // KullanÄ±cÄ± sadece kendi verisini okuyabilir
        ".read": "auth != null && auth.uid === $userId",
        
        // KullanÄ±cÄ± sadece kendi verisini yazabilir
        ".write": "auth != null && auth.uid === $userId",
        
        // Veri yapÄ±sÄ± validasyonu
        ".validate": "newData.hasChildren(['email', 'displayName', 'credits', 'createdAt'])",
        
        "email": {
          ".validate": "newData.isString() && newData.val().matches(/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\\.[A-Z]{2,}$/i)"
        },
        
        "displayName": {
          ".validate": "newData.isString() && newData.val().length >= 2 && newData.val().length <= 100"
        },
        
        "credits": {
          ".validate": "newData.isNumber() && newData.val() >= 0"
        },
        
        "totalSpent": {
          ".validate": "newData.isNumber() && newData.val() >= 0"
        },
        
        "createdAt": {
          ".validate": "newData.isNumber()"
        },
        
        "isAdmin": {
          ".validate": "newData.isBoolean()"
        },
        
        // DiÄŸer Ã¶zel alanlar
        "$other": {
          ".validate": true
        }
      }
    },
    
    // âš½ MAÃ‡ VERÄ°LERÄ°
    "matches": {
      // Herkes maÃ§larÄ± okuyabilir (giriÅŸ yapmÄ±ÅŸ olmalÄ±)
      ".read": "auth != null",
      
      // Sadece backend yazabilir (client'tan yazma yok)
      ".write": false,
      
      "$date": {
        ".validate": "newData.hasChildren()",
        
        "$matchId": {
          ".validate": "newData.hasChildren(['homeTeam', 'awayTeam', 'league', 'date', 'time', 'timestamp', 'status'])",
          
          "homeTeam": {
            ".validate": "newData.isString() && newData.val().length > 0"
          },
          
          "awayTeam": {
            ".validate": "newData.isString() && newData.val().length > 0"
          },
          
          "league": {
            ".validate": "newData.isString() && newData.val().length > 0"
          },
          
          "date": {
            ".validate": "newData.isString()"
          },
          
          "time": {
            ".validate": "newData.isString()"
          },
          
          "timestamp": {
            ".validate": "newData.isNumber()"
          },
          
          "status": {
            ".validate": "newData.isString() && (newData.val() === 'scheduled' || newData.val() === 'live' || newData.val() === 'finished')"
          },
          
          // DiÄŸer opsiyonel alanlar
          "$other": {
            ".validate": true
          }
        }
      }
    },
    
    // ðŸŽ« KULLANICI KUPONLARI
    "coupons": {
      "$userId": {
        // KullanÄ±cÄ± sadece kendi kuponlarÄ±nÄ± gÃ¶rebilir
        ".read": "auth != null && auth.uid === $userId",
        
        // KullanÄ±cÄ± sadece kendi kuponlarÄ±nÄ± ekleyebilir
        ".write": "auth != null && auth.uid === $userId",
        
        "$couponId": {
          ".validate": "newData.hasChildren(['matches', 'analysis', 'createdAt'])",
          
          "matches": {
            ".validate": "newData.hasChildren()"
          },
          
          "analysis": {
            ".validate": "newData.isString()"
          },
          
          "createdAt": {
            ".validate": "newData.isNumber()"
          },
          
          "detailedAnalysis": {
            ".validate": "newData.isBoolean()"
          },
          
          "creditCost": {
            ".validate": "newData.isNumber() && newData.val() > 0"
          },
          
          // DiÄŸer kupon verileri
          "$other": {
            ".validate": true
          }
        }
      }
    },
    
    // ðŸš« YASAKLI IP ADRESLERÄ° (Admin Only)
    "bannedIPs": {
      // Sadece admin okuyabilir
      ".read": "auth != null && root.child('users').child(auth.uid).child('isAdmin').val() === true",
      
      // Sadece admin yazabilir
      ".write": "auth != null && root.child('users').child(auth.uid).child('isAdmin').val() === true",
      
      "$ipAddress": {
        ".validate": "newData.hasChildren(['reason', 'bannedAt'])",
        
        "reason": {
          ".validate": "newData.isString() && newData.val().length > 0"
        },
        
        "bannedAt": {
          ".validate": "newData.isNumber()"
        },
        
        "bannedBy": {
          ".validate": "newData.isString()"
        }
      }
    },
    
    // ðŸ“ KAYITLI IP ADRESLERÄ° (Duplicate kontrol)
    "registeredIPs": {
      // Sadece admin okuyabilir
      ".read": "auth != null && root.child('users').child(auth.uid).child('isAdmin').val() === true",
      
      // Sistem yazabilir (backend)
      ".write": false,
      
      "$ipAddress": {
        ".validate": "newData.hasChildren(['userId', 'registeredAt'])",
        
        "userId": {
          ".validate": "newData.isString()"
        },
        
        "registeredAt": {
          ".validate": "newData.isNumber()"
        }
      }
    },
    
    // ðŸ’³ Ã–DEME Ä°ÅžLEMLERÄ° (Log)
    "payments": {
      "$userId": {
        // KullanÄ±cÄ± sadece kendi Ã¶demelerini gÃ¶rebilir
        ".read": "auth != null && (auth.uid === $userId || root.child('users').child(auth.uid).child('isAdmin').val() === true)",
        
        // Sadece backend yazabilir
        ".write": false,
        
        "$paymentId": {
          ".validate": "newData.hasChildren(['amount', 'credits', 'method', 'status', 'createdAt'])",
          
          "amount": {
            ".validate": "newData.isNumber() && newData.val() > 0"
          },
          
          "credits": {
            ".validate": "newData.isNumber() && newData.val() > 0"
          },
          
          "method": {
            ".validate": "newData.isString() && (newData.val() === 'bank_transfer' || newData.val() === 'credit_card')"
          },
          
          "status": {
            ".validate": "newData.isString() && (newData.val() === 'pending' || newData.val() === 'completed' || newData.val() === 'failed')"
          },
          
          "createdAt": {
            ".validate": "newData.isNumber()"
          },
          
          "$other": {
            ".validate": true
          }
        }
      }
    },
    
    // ðŸ“Š ADMIN DASHBOARD VERÄ°LERÄ°
    "admin": {
      // Sadece admin eriÅŸebilir
      ".read": "auth != null && root.child('users').child(auth.uid).child('isAdmin').val() === true",
      ".write": "auth != null && root.child('users').child(auth.uid).child('isAdmin').val() === true",
      
      "$dataType": {
        ".validate": true
      }
    },
    
    // ðŸ”§ SÄ°STEM AYARLARI
    "systemSettings": {
      // Herkes okuyabilir (genel ayarlar)
      ".read": true,
      
      // Sadece admin yazabilir
      ".write": "auth != null && root.child('users').child(auth.uid).child('isAdmin').val() === true",
      
      "$setting": {
        ".validate": true
      }
    },
    
    // ðŸ“± ANALÄ°Z GEÃ‡MÄ°ÅžÄ° (Ä°statistikler iÃ§in)
    "analytics": {
      // Herkes kendi analizlerini gÃ¶rebilir, admin hepsini gÃ¶rebilir
      ".read": "auth != null",
      
      // Sadece backend yazabilir
      ".write": false,
      
      "$userId": {
        ".read": "auth != null && (auth.uid === $userId || root.child('users').child(auth.uid).child('isAdmin').val() === true)",
        
        "$analysisId": {
          ".validate": "newData.hasChildren(['matchCount', 'analysisType', 'createdAt'])"
        }
      }
    }
  }
}
